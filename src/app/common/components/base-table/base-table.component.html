<div class="base-table-container">
  <!-- Toolbar: Filter + Actions -->
  <div class="table-toolbar" *ngIf="showFilter || showActions">
    <div class="filter-section" *ngIf="showFilter">
      <input
        type="text"
        class="filter-input"
        placeholder="×—×™×¤×•×©..."
        [(ngModel)]="filterText"
        (input)="onFilterChange($event)"
      />
      <button class="clear-filter" *ngIf="filterText" (click)="clearFilter()">
        âœ•
      </button>
    </div>

    <div class="toolbar-actions">
      <button
        *ngIf="showAdd && !readonly"
        class="add-btn"
        (click)="onAdd.emit()"
        title="×”×•×¡×£ ×—×“×©"
      >
        âž• {{ addButtonText }}
      </button>
      <button class="refresh-btn" (click)="refresh()" title="×¨×¢× ×•×Ÿ">
        ðŸ”„
      </button>
    </div>
  </div>

  <!-- Table Wrapper (Scrollable) -->
  <div class="table-wrapper">
    <!-- Loading Overlay -->
    <div class="loading-overlay" *ngIf="loading">
      <div class="spinner"></div>
      <span>×˜×•×¢×Ÿ...</span>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!loading && (!data || data.length === 0)">
      <p>{{ emptyMessage }}</p>
    </div>

    <!-- Table -->
    <table *ngIf="!loading && data && data.length > 0">
      <thead>
        <tr>
          <!-- Selection Column -->
          <th class="selection-column" *ngIf="selectable">
            <input
              type="checkbox"
              [(ngModel)]="selectAll"
              (change)="toggleSelectAll()"
            />
          </th>

          <!-- Data Columns -->
          <th
            *ngFor="let column of visibleColumns"
            [class]="column.headerClass"
            [ngStyle]="column.headerStyle"
            [style.width]="column.width"
            (click)="sortColumn(column)"
            [class.sortable]="sortable && column.sortable !== false"
          >
            {{ column.header || column.field }}
            <span class="sort-icon" *ngIf="sortable && column.sortable !== false">
              {{ getSortIcon(column) }}
            </span>
          </th>

          <!-- Actions Column -->
          <th class="actions-column" *ngIf="showActions && !readonly">
            ×¤×¢×•×œ×•×ª
          </th>
        </tr>
      </thead>

      <tbody>
        <tr
          *ngFor="let row of data; trackBy: trackByField"
          (click)="handleRowClick(row)"
          [class.selected]="isRowSelected(row)"
        >
          <!-- Selection Column -->
          <td class="selection-column" *ngIf="selectable">
            <input
              type="checkbox"
              [checked]="isRowSelected(row)"
              (change)="toggleRowSelection(row)"
              (click)="$event.stopPropagation()"
            />
          </td>

          <!-- Data Columns -->
          <td
            *ngFor="let column of visibleColumns"
            [class]="column.cssClass"
            [ngStyle]="column.style"
          >
            <!-- Custom Template -->
            <ng-container *ngIf="getColumnTemplate(column.field) as template">
              <ng-container
                *ngTemplateOutlet="template; context: { $implicit: row }"
              ></ng-container>
            </ng-container>

            <!-- Default Value -->
            <ng-container *ngIf="!getColumnTemplate(column.field)">
              {{ getCellValue(row, column) }}
            </ng-container>
          </td>

          <!-- Actions Column -->
          <td class="actions-column" *ngIf="showActions && !readonly">
            <button
              class="action-btn edit-btn"
              (click)="handleEdit(row, $event)"
              title="×¢×¨×™×›×”"
            >
              âœŽ
            </button>
            <button
              class="action-btn delete-btn"
              (click)="handleDelete(row, $event)"
              title="×ž×—×™×§×”"
            >
              ðŸ—‘
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Footer: Pagination -->
  <div class="table-footer" *ngIf="showPagination && totalRecords > 0">
    <div class="pagination-info">
      ×ž×¦×™×’ {{ (currentPage - 1) * pageSize + 1 }}-{{ Math.min(currentPage * pageSize, totalRecords) }}
      ×ž×ª×•×š {{ totalRecords }}
    </div>

    <div class="pagination-controls">
      <button
        class="page-btn"
        (click)="previousPage()"
        [disabled]="currentPage === 1"
      >
        â–º
      </button>

      <button
        *ngFor="let page of displayedPages"
        class="page-btn"
        [class.active]="page === currentPage"
        (click)="goToPage(page)"
      >
        {{ page }}
      </button>

      <button
        class="page-btn"
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
      >
        â—„
      </button>
    </div>
  </div>
</div>
